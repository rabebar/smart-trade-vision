<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAIA AI | Newsroom âœï¸</title>
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="/static/style.css">
    <style>
        body { background: #020617; color: white; font-family: 'Cairo', sans-serif; padding: 40px 20px; }
        .editor-container { max-width: 900px; margin: 0 auto; background: #0b1222; border: 2px solid var(--primary); border-radius: 30px; padding: 40px; box-shadow: 0 0 50px rgba(59, 130, 246, 0.2); }
        .editor-header { text-align: center; margin-bottom: 40px; }
        .editor-header h1 { font-weight: 900; color: var(--primary); font-size: 35px; }
        .input-group { margin-bottom: 25px; }
        .input-group label { display: block; margin-bottom: 10px; font-weight: 700; color: var(--muted); }
        .editor-input { width: 100%; padding: 15px; background: #000; border: 1px solid #333; border-radius: 12px; color: #fff; font-family: inherit; font-size: 16px; outline: none; }
        .editor-input:focus { border-color: var(--primary); }
        .editor-textarea { height: 250px; resize: vertical; }
        .publish-btn { width: 100%; height: 70px; background: var(--primary); color: #000; border: none; border-radius: 15px; font-size: 22px; font-weight: 900; cursor: pointer; transition: 0.3s; }
        .publish-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(59, 130, 246, 0.4); }
        .status-msg { text-align: center; margin-top: 20px; font-weight: 800; display: none; }
    </style>
</head>
<body>

<div class="editor-container">
    <div class="editor-header">
        <img src="/static/logo.png" alt="K" style="height: 60px; margin-bottom: 15px;">
        <h1>ØºØ±ÙØ© Ø§Ù„ØªØ­Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ</h1>
        <p style="color: var(--muted);">Ø£Ù‡Ù„Ø§Ù‹ Ø¨Ùƒ ÙŠØ§ Ù…Ù„ÙƒØŒ Ø§ÙƒØªØ¨ Ø±Ø¤ÙŠØªÙƒ Ù„ÙŠØ±ØªÙ‡Ø§ Ø§Ù„Ø¹Ø§Ù„Ù…</p>
    </div>

    <div id="editor-form">
        <div class="input-group">
            <label>Ù„ØºØ© Ø§Ù„Ù…Ù‚Ø§Ù„</label>
            <select id="art-lang" class="editor-input" style="background-color: #1e293b;">
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ğŸ‡¸ğŸ‡¦</option>
                <option value="en">English ğŸ‡ºğŸ‡¸</option>
            </select>
        </div>

        <div class="input-group">
            <label>Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„</label>
            <input type="text" id="art-title" class="editor-input" placeholder="Ù…Ø«Ù„Ø§Ù‹: Ø§Ù†ÙØ¬Ø§Ø± ÙˆØ´ÙŠÙƒ ÙÙŠ Ø£Ø³Ø¹Ø§Ø± Ø§Ù„Ø°Ù‡Ø¨">
        </div>

        <div class="input-group">
            <label>Ù…Ù„Ø®Øµ Ù‚ØµÙŠØ± (ÙŠØ¸Ù‡Ø± ÙÙŠ ØµØ§Ù„Ø© Ø§Ù„Ø¹Ø±Ø¶)</label>
            <input type="text" id="art-summary" class="editor-input" placeholder="Ø§ÙƒØªØ¨ Ø³Ø·Ø±ÙŠÙ† ÙŠØ¬Ø°Ø¨Ø§Ù† Ø§Ù„Ù…ØªØ¯Ø§ÙˆÙ„ Ù„Ù„Ù‚Ø±Ø§Ø¡Ø©">
        </div>

        <div class="input-group">
            <label>Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ø§Ù„Ø¨Ø§Ø±Ø²Ø© (URL)</label>
            <input type="text" id="art-image" class="editor-input" placeholder="Ø¶Ø¹ Ù‡Ù†Ø§ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© (Ù…Ù† Ù…ÙˆÙ‚Ø¹ Ø®Ø§Ø±Ø¬ÙŠ Ø£Ùˆ Ù…Ø¬Ù„Ø¯ Ø§Ù„ØµÙˆØ±)">
        </div>

        <div class="input-group">
            <label>Ù…Ø­ØªÙˆÙ‰ Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„ÙƒØ§Ù…Ù„</label>
            <textarea id="art-content" class="editor-input editor-textarea" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ Ø§Ù„ØªØ­Ù„ÙŠÙ„ Ø§Ù„Ù…ÙØµÙ„ ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„Ù…Ù‚Ø§Ù„..."></textarea>
        </div>

        <button class="publish-btn" onclick="publishArticle()">
            <i class="fa-solid fa-paper-plane"></i> Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„ ÙÙŠ ØµØ§Ù„Ø© Ø§Ù„Ø¹Ø±Ø¶
        </button>

        <p id="status-text" class="status-msg"></p>
    </div>
</div>

<script>
    const token = localStorage.getItem("token");

    // 1. Ø­Ù…Ø§ÙŠØ© ØºØ±ÙØ© Ø§Ù„Ù…Ù„Ùƒ: Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ø§Ù„ØµÙ„Ø§Ø­ÙŠØ© ÙÙˆØ±Ø§Ù‹
    async function checkAdmin() {
        if (!token) { window.location.href = "/"; return; }
        try {
            const res = await fetch("/api/me", { headers: {"Authorization": "Bearer " + token} });
            const user = await res.json();
            if (!user.is_admin) {
                alert("ğŸ”’ Ù…Ù†Ø·Ù‚Ø© Ù…Ø­Ø¸ÙˆØ±Ø©: Ù‡Ø°Ù‡ Ø§Ù„ØºØ±ÙØ© Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ù„Ùƒ ÙÙ‚Ø·.");
                window.location.href = "/";
            }
        } catch (e) { window.location.href = "/"; }
    }

    // 2. Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø±
    async function publishArticle() {
        const btn = document.querySelector(".publish-btn");
        const status = document.getElementById("status-text");

        const data = {
            title: document.getElementById("art-title").value,
            summary: document.getElementById("art-summary").value,
            content: document.getElementById("art-content").value,
            image_url: document.getElementById("art-image").value,
            language: document.getElementById("art-lang").value
        };

        if (!data.title || !data.content) return alert("ÙŠØ±Ø¬Ù‰ ØªØ¹Ø¨Ø¦Ø© Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„");

        btn.disabled = true;
        btn.innerText = "Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±...";

        try {
            const res = await fetch("/api/admin/add_article", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": "Bearer " + token
                },
                body: JSON.stringify(data)
            });

            if (res.ok) {
                status.style.display = "block";
                status.innerText = "âœ… ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„Ù…Ù‚Ø§Ù„ Ø§Ù„Ø¢Ù† Ù…ØªØ§Ø­ Ù„Ù„Ø¬Ù…Ù‡ÙˆØ±.";
                status.style.color = "var(--success)";
                document.getElementById("editor-form").reset(); // ØªÙØ±ÙŠØº Ø§Ù„Ø®Ø§Ù†Ø§Øª
            } else {
                alert("ÙØ´Ù„ Ø§Ù„Ù†Ø´Ø±ØŒ ÙŠØ±Ø¬Ù‰ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø© Ù„Ø§Ø­Ù‚Ø§Ù‹.");
            }
        } catch (e) { alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„"); }
        
        btn.disabled = false;
        btn.innerText = "Ù†Ø´Ø± Ù…Ù‚Ø§Ù„ Ø¬Ø¯ÙŠØ¯";
    }

    window.onload = checkAdmin;
</script>
</body>
</html>