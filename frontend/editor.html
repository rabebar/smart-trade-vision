<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>KAIA AI | Newsroom âœï¸</title>
    
    <!-- Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ© -->
    <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
    <link rel="stylesheet" href="/static/style.css">
    
    <style>
        body { background: #020617; color: white; font-family: 'Cairo', sans-serif; padding: 40px 20px; }
        .editor-container { max-width: 900px; margin: 0 auto; background: #0b1222; border: 2px solid var(--primary); border-radius: 30px; padding: 40px; box-shadow: 0 0 50px rgba(59, 130, 246, 0.2); }
        .editor-header { text-align: center; margin-bottom: 40px; }
        .editor-header h1 { font-weight: 900; color: var(--primary); font-size: 35px; margin-top: 15px; }
        
        .input-group { margin-bottom: 25px; }
        .input-group label { display: block; margin-bottom: 10px; font-weight: 700; color: var(--muted); font-size: 14px; }
        
        .editor-input { width: 100%; padding: 15px; background: #000; border: 1px solid #333; border-radius: 12px; color: #fff; font-family: inherit; font-size: 16px; outline: none; transition: 0.3s; }
        .editor-input:focus { border-color: var(--primary); box-shadow: 0 0 10px rgba(59, 130, 246, 0.3); }
        .editor-textarea { height: 250px; resize: vertical; line-height: 1.8; }
        
        .publish-btn { width: 100%; height: 70px; background: var(--primary); color: #000; border: none; border-radius: 15px; font-size: 22px; font-weight: 900; cursor: pointer; transition: 0.3s; display: flex; align-items: center; justify-content: center; gap: 15px; }
        .publish-btn:hover { transform: translateY(-3px); box-shadow: 0 10px 20px rgba(59, 130, 246, 0.4); }
        .publish-btn:disabled { opacity: 0.5; cursor: not-allowed; }
        
        .status-msg { text-align: center; margin-top: 20px; font-weight: 800; padding: 15px; border-radius: 10px; display: none; }
        
        /* ØªØ­Ø³ÙŠÙ† Ø´ÙƒÙ„ Ø§Ù„Ù‚Ø§Ø¦Ù…Ø© Ø§Ù„Ù…Ù†Ø³Ø¯Ù„Ø© */
        select.editor-input { cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 24 24'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: left 15px center; background-size: 20px; }
    </style>
</head>
<body>

<div class="editor-container">
    <div class="editor-header">
        <img src="/static/logo.png" alt="KAIA" style="height: 60px; filter: drop-shadow(0 0 10px var(--primary));">
        <h1>ØºØ±ÙØ© Ø§Ù„ØªØ­Ø±ÙŠØ± ÙˆØ§Ù„Ø¥Ø¹Ù„Ø§Ù… Ø§Ù„Ù…Ø¤Ø³Ø³ÙŠ</h1>
        <p style="color: var(--muted); font-weight: 600;">Ø¨ÙˆØ§Ø¨Ø© Ø§Ù„Ù…Ù„Ùƒ Ø±Ø¨ÙŠØ¹ Ø§Ù„Ø¨Ø±ØºÙˆØ«ÙŠ Ù„Ù†Ø´Ø± Ø§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„Ø³ÙŠØ§Ø¯ÙŠØ©</p>
    </div>

    <div id="editor-form">
        <!-- 1. Ù„ØºØ© Ø§Ù„Ù…Ù‚Ø§Ù„ -->
        <div class="input-group">
            <label><i class="fa-solid fa-language"></i> Ù„ØºØ© Ø§Ù„Ù†Ø´Ø±</label>
            <select id="art-lang" class="editor-input">
                <option value="ar">Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© ğŸ‡¸ğŸ‡¦ (ØªØ¸Ù‡Ø± Ù„Ù„Ø¬Ù…Ù‡ÙˆØ± Ø§Ù„Ø¹Ø±Ø¨ÙŠ)</option>
                <option value="en">English ğŸ‡ºğŸ‡¸ (ØªØ¸Ù‡Ø± Ù„Ù„Ø¬Ù…Ù‡ÙˆØ± Ø§Ù„Ø¹Ø§Ù„Ù…ÙŠ)</option>
            </select>
        </div>

        <!-- 2. Ø§Ù„Ø¹Ù†ÙˆØ§Ù† -->
        <div class="input-group">
            <label><i class="fa-solid fa-heading"></i> Ø¹Ù†ÙˆØ§Ù† Ø§Ù„Ù…Ù‚Ø§Ù„</label>
            <input type="text" id="art-title" class="editor-input" placeholder="Ø§ÙƒØªØ¨ Ø¹Ù†ÙˆØ§Ù†Ø§Ù‹ Ø¬Ø°Ø§Ø¨Ø§Ù‹ ÙˆÙ…Ø®ØªØµØ±Ø§Ù‹...">
        </div>

        <!-- 3. Ø§Ù„Ù…Ù„Ø®Øµ -->
        <div class="input-group">
            <label><i class="fa-solid fa-align-right"></i> Ù…Ù„Ø®Øµ Ø§Ù„Ù…Ù‚Ø§Ù„ (ÙŠØ¸Ù‡Ø± ÙÙŠ Ø§Ù„ÙƒØ±Øª Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠ)</label>
            <input type="text" id="art-summary" class="editor-input" placeholder="Ø³Ø·Ø± ÙˆØ§Ø­Ø¯ ÙŠÙ„Ø®Øµ Ø£Ù‡Ù…ÙŠØ© Ù‡Ø°Ø§ Ø§Ù„ØªÙ‚Ø±ÙŠØ±...">
        </div>

        <!-- 4. Ø§Ù„ØµÙˆØ±Ø© -->
        <div class="input-group">
            <label><i class="fa-solid fa-image"></i> Ø±Ø§Ø¨Ø· ØµÙˆØ±Ø© Ø§Ù„ØºÙ„Ø§Ù (URL)</label>
            <input type="text" id="art-image" class="editor-input" placeholder="Ø¶Ø¹ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙˆØ±Ø© Ù‡Ù†Ø§ (ÙŠÙØ¶Ù„ Ø´Ø§Ø±Øª Ø£Ùˆ ØµÙˆØ±Ø© Ù…Ø¤Ø³Ø³ÙŠØ©)">
        </div>

        <!-- 5. Ø§Ù„Ù…Ø­ØªÙˆÙ‰ -->
        <div class="input-group">
            <label><i class="fa-solid fa-pen-fancy"></i> Ø§Ù„Ù…Ø­ØªÙˆÙ‰ Ø§Ù„ÙƒØ§Ù…Ù„ Ù„Ù„ØªØ­Ù„ÙŠÙ„</label>
            <textarea id="art-content" class="editor-input editor-textarea" placeholder="Ø§ÙƒØªØ¨ Ù‡Ù†Ø§ ØªÙØ§ØµÙŠÙ„ Ø§Ù„ØªØ­Ù„ÙŠÙ„ØŒ Ø§Ù„Ø£Ø±Ù‚Ø§Ù…ØŒ ÙˆØ§Ù„Ø±Ø¤ÙŠØ© Ø§Ù„ÙÙ†ÙŠØ© Ø§Ù„ÙƒØ§Ù…Ù„Ø©..."></textarea>
        </div>

        <!-- Ø²Ø± Ø§Ù„Ù†Ø´Ø± -->
        <button class="publish-btn" onclick="publishArticle()">
            <i class="fa-solid fa-paper-plane"></i> 
            <span>Ù†Ø´Ø± Ø§Ù„Ù…Ù‚Ø§Ù„ ÙÙŠ ØµØ§Ù„Ø© Ø§Ù„Ø¹Ø±Ø¶ Ø§Ù„Ø¢Ù†</span>
        </button>

        <!-- Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ø­Ø§Ù„Ø© -->
        <div id="status-text" class="status-msg"></div>
    </div>
</div>

<script>
    const token = localStorage.getItem("token");

    // 1. Ø­Ù…Ø§ÙŠØ© Ø§Ù„ØºØ±ÙØ©: Ø§Ù„ØªØ£ÙƒØ¯ Ù…Ù† Ù‡ÙˆÙŠØ© Ø§Ù„Ø¢Ø¯Ù…Ù† ÙÙˆØ± Ø§Ù„Ø¯Ø®ÙˆÙ„
    async function checkAdminStatus() {
        if (!token) {
            window.location.href = "/";
            return;
        }
        try {
            const res = await fetch("/api/me", { 
                headers: {"Authorization": "Bearer " + token} 
            });
            const user = await res.json();
            if (!user.is_admin) {
                alert("ğŸ”’ Ù…Ù†Ø·Ù‚Ø© Ù…Ø­Ø¸ÙˆØ±Ø©: Ù‡Ø°Ù‡ Ø§Ù„ØºØ±ÙØ© Ù…Ø®ØµØµØ© Ù„Ù„Ù…Ù„Ùƒ ÙÙ‚Ø·.");
                window.location.href = "/";
            }
        } catch (e) {
            window.location.href = "/";
        }
    }

    // 2. Ø¯Ø§Ù„Ø© Ø§Ù„Ù†Ø´Ø± Ø§Ù„Ù…ØµÙ„Ø­Ø© (ØªØ·Ø§Ø¨Ù‚ Ø§Ø®ØªØ¨Ø§Ø± Swagger Ø¨Ù†Ø³Ø¨Ø© 100%)
    async function publishArticle() {
        const btn = document.querySelector(".publish-btn");
        const status = document.getElementById("status-text");

        // Ø¬Ù…Ø¹ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª ÙˆØªÙ†Ø¸ÙŠÙÙ‡Ø§
        const articleData = {
            title: document.getElementById("art-title").value.trim(),
            summary: document.getElementById("art-summary").value.trim(),
            content: document.getElementById("art-content").value.trim(),
            image_url: document.getElementById("art-image").value.trim(),
            language: document.getElementById("art-lang").value
        };

        // Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„Ù…Ø¯Ø®Ù„Ø§Øª Ø§Ù„Ø£Ø³Ø§Ø³ÙŠØ©
        if (!articleData.title || !articleData.content) {
            return alert("Ø§Ù„Ø±Ø¬Ø§Ø¡ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ù„Ø¹Ù†ÙˆØ§Ù† ÙˆØ§Ù„Ù…Ø­ØªÙˆÙ‰ Ø¹Ù„Ù‰ Ø§Ù„Ø£Ù‚Ù„.");
        }

        // Ù‚ÙÙ„ Ø§Ù„Ø²Ø± ÙˆØªØºÙŠÙŠØ± Ø§Ù„Ù†Øµ
        btn.disabled = true;
        btn.innerHTML = '<i class="fa-solid fa-spinner fa-spin"></i> Ø¬Ø§Ø±ÙŠ Ø§Ù„Ù†Ø´Ø± ÙÙŠ Ø§Ù„Ø³ÙŠØ±ÙØ±...';

        try {
            const response = await fetch("/api/admin/add_article", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "accept": "application/json",
                    "Authorization": "Bearer " + token
                },
                body: JSON.stringify(articleData)
            });

            const result = await response.json();

            if (response.ok) {
                // Ø¹Ø±Ø¶ Ø±Ø³Ø§Ù„Ø© Ø§Ù„Ù†Ø¬Ø§Ø­
                status.style.display = "block";
                status.style.background = "rgba(16, 185, 129, 0.1)";
                status.style.color = "#10b981";
                status.style.border = "1px solid #10b981";
                status.innerText = "âœ… ØªÙ… Ø§Ù„Ù†Ø´Ø± Ø¨Ù†Ø¬Ø§Ø­! Ø§Ù„Ù…Ù‚Ø§Ù„ Ù…ØªØ§Ø­ Ø§Ù„Ø¢Ù† Ù„Ù„Ø¬Ù…Ù‡ÙˆØ± ÙÙŠ Ø§Ù„ØµÙØ­Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ©.";
                
                // Ù…Ø³Ø­ Ø§Ù„Ø¨ÙŠØ§Ù†Ø§Øª Ù…Ù† Ø§Ù„Ø®Ø§Ù†Ø§Øª Ù„ØªØ¬Ù‡ÙŠØ² Ù…Ù‚Ø§Ù„ Ø¬Ø¯ÙŠØ¯
                document.getElementById("art-title").value = "";
                document.getElementById("art-summary").value = "";
                document.getElementById("art-content").value = "";
                document.getElementById("art-image").value = "";
                
                // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø±Ø³Ø§Ù„Ø© Ø¨Ø¹Ø¯ 5 Ø«ÙˆØ§Ù†Ù
                setTimeout(() => { status.style.display = "none"; }, 5000);
            } else {
                alert("ÙØ´Ù„ Ø§Ù„Ø³ÙŠØ±ÙØ± ÙÙŠ Ù…Ø¹Ø§Ù„Ø¬Ø© Ø§Ù„Ø·Ù„Ø¨: " + (result.detail || "Ø®Ø·Ø£ ØºÙŠØ± Ù…Ø¹Ø±ÙˆÙ"));
            }
        } catch (error) {
            console.error("Critical Fetch Error:", error);
            alert("Ø®Ø·Ø£ ÙÙŠ Ø§Ù„Ø§ØªØµØ§Ù„: ØªØ£ÙƒØ¯ Ù…Ù† Ø¥Ù†ØªØ±Ù†Øª Ø§Ù„Ø¬Ù‡Ø§Ø² ÙˆÙ…Ù† Ø±ÙØ¹ Ø§Ù„ØªØ¹Ø¯ÙŠÙ„Ø§Øª Ø§Ù„Ø£Ø®ÙŠØ±Ø©.");
        } finally {
            btn.disabled = false;
            btn.innerHTML = '<i class="fa-solid fa-paper-plane"></i> Ù†Ø´Ø± Ù…Ù‚Ø§Ù„ Ø¬Ø¯ÙŠØ¯';
        }
    }

    // ØªØ´ØºÙŠÙ„ ÙØ­Øµ Ø§Ù„Ø­Ù…Ø§ÙŠØ© Ø¹Ù†Ø¯ Ø§Ù„ØªØ­Ù…ÙŠÙ„
    window.onload = checkAdminStatus;
</script>
</body>
</html>