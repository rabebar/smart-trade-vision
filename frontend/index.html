<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CANA AI</title>

  <!-- Fonts -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;600;700;800;900&family=Outfit:wght@400;600;700;800;900&display=swap" rel="stylesheet">

  <!-- FontAwesome -->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

  <!-- ✅ كسر كاش -->
  <link rel="stylesheet" href="/static/style.css?v=fix_final_9" />
</head>

<body>

  <!-- NAV -->
  <header class="navbar">
    <div class="logo-container">
      <div class="logo-icon"><i class="fa-solid fa-cubes"></i></div>
      <div class="brand-text">
        <h1>CANA</h1>
        <span>AI TRADING</span>
      </div>
    </div>

    <div class="nav-controls">
      <!-- ✅ زر الباقات/الشحن (أيقونة واحدة) -->
      <button id="open-subscription" class="icon-btn" title="الباقات / الشحن">
        <i class="fa-solid fa-gem"></i>
      </button>

      <!-- ✅ اللغة -->
      <button id="lang-btn" class="lang-switcher" title="Language">
        <span id="lang-text">English</span> <i class="fa-solid fa-globe"></i>
      </button>

      <!-- ✅ معلومات المستخدم -->
      <div id="user-info" class="user-info hidden">
        <div class="credits-pill" title="Credits">
          <i class="fa-solid fa-coins"></i>
          <span id="credits-count">0</span>
        </div>

        <button id="portfolio-btn" class="icon-btn" title="المحفظة">
          <i class="fa-solid fa-wallet"></i>
        </button>

        <div class="nav-user-badge">
          <span id="nav-username">user</span>
        </div>

        <button id="logout-btn" class="btn-gradient small">Logout</button>
      </div>
    </div>
  </header>

  <!-- ✅ TICKERS -->
  <div class="tickers-wrapper">

    <!-- ✅ Price Ticker Tape (TradingView) -->
    <div class="top-tape glass-panel">
      <div class="tradingview-widget-container" style="height:46px;width:100%;">
        <div class="tradingview-widget-container__widget"></div>
        <script type="text/javascript"
          src="https://s3.tradingview.com/external-embedding/embed-widget-ticker-tape.js"
          async>
        {
          "symbols": [
            {"proName":"FOREXCOM:EURUSD","title":"EURUSD"},
            {"proName":"OANDA:XAUUSD","title":"Gold"},
            {"proName":"FOREXCOM:GBPUSD","title":"GBPUSD"},
            {"proName":"FOREXCOM:USDJPY","title":"USDJPY"},
            {"proName":"BINANCE:BTCUSDT","title":"BTC"},
            {"proName":"BINANCE:ETHUSDT","title":"ETH"}
          ],
          "showSymbolLogo": true,
          "isTransparent": true,
          "displayMode": "adaptive",
          "colorTheme": "dark",
          "locale": "en"
        }
        </script>
      </div>
    </div>

    <!-- ✅ News Ticker -->
    <div class="news-ticker-container">
      <div class="ticker-label">
        <span id="ticker-label-text">أخبار الاقتصاد</span>
      </div>
      <div class="ticker-wrap">
        <div class="ticker-move" id="news-ticker-content">
          <div class="ticker-item">...</div>
        </div>
      </div>
    </div>

  </div>

  <!-- HERO -->
  <section class="hero-section">
    <div class="hero-grid-layout">

      <!-- ✅ EURUSD (Left widget) -->
      <div class="hero-side-widget glass-panel">
        <div class="widget-title">EURUSD</div>
        <div class="side-box" id="eurusd-widget">
          <div class="tradingview-widget-container" style="height:100%;width:100%;">
            <div class="tradingview-widget-container__widget"></div>
            <script type="text/javascript"
              src="https://s3.tradingview.com/external-embedding/embed-widget-technical-analysis.js"
              async>
            {
              "interval": "15m",
              "width": "100%",
              "height": "100%",
              "symbol": "FOREXCOM:EURUSD",
              "showIntervalTabs": true,
              "displayMode": "single",
              "locale": "en",
              "colorTheme": "dark",
              "isTransparent": true
            }
            </script>
          </div>
        </div>
      </div>

      <!-- Center content -->
      <div class="hero-content-center">
        <div class="glow-circle"></div>
        <h1 class="main-title" data-i18n="title_hero">CANA AI ثورة التداول <br> بقدرات الذكاء الاصطناعي الفائق</h1>
        <p class="hero-sub" data-i18n="subtitle">تجاوز التحليل البشري. خوارزميات متخصصة تكشف لك ما لا تراه العين.</p>
        <div class="scroll-indicator">↓</div>
      </div>

      <!-- ✅ XAUUSD (Right widget) -->
      <div class="hero-side-widget glass-panel">
        <div class="widget-title">XAUUSD</div>
        <div class="side-box" id="xauusd-widget">
          <div class="tradingview-widget-container" style="height:100%;width:100%;">
            <div class="tradingview-widget-container__widget"></div>
            <script type="text/javascript"
              src="https://s3.tradingview.com/external-embedding/embed-widget-technical-analysis.js"
              async>
            {
              "interval": "15m",
              "width": "100%",
              "height": "100%",
              "symbol": "OANDA:XAUUSD",
              "showIntervalTabs": true,
              "displayMode": "single",
              "locale": "en",
              "colorTheme": "dark",
              "isTransparent": true
            }
            </script>
          </div>
        </div>
      </div>

    </div>
  </section>

  <!-- STEPS -->
  <section class="steps-section">
    <div class="steps-container">
      <div class="step-card">
        <div class="step-icon"><i class="fa-solid fa-camera"></i></div>
        <h3 data-i18n="step1_title">1. التقط الصورة</h3>
        <p data-i18n="step1_desc">صور الشارت ثم الصقها هنا (Ctrl+V).</p>
      </div>
      <div class="step-arrow"><i class="fa-solid fa-arrow-left"></i></div>

      <div class="step-card">
        <div class="step-icon"><i class="fa-solid fa-sliders"></i></div>
        <h3 data-i18n="step2_title">2. اختر الاستراتيجية</h3>
        <p data-i18n="step2_desc">حدد نوع التحليل والفريم.</p>
      </div>
      <div class="step-arrow"><i class="fa-solid fa-arrow-left"></i></div>

      <div class="step-card">
        <div class="step-icon"><i class="fa-solid fa-bullseye"></i></div>
        <h3 data-i18n="step3_title">3. اقتنص الفرصة</h3>
        <p data-i18n="step3_desc">تحليل فوري للدخول والهدف.</p>
      </div>
    </div>
  </section>

  <!-- APP -->
  <main class="app-container">
    <div class="glass-card">
      <div class="card-header">
        <i class="fa-solid fa-wand-magic-sparkles"></i>
        <h2 data-i18n="upload_header">مركز تحليل CANA</h2>
      </div>

      <!-- Upload -->
      <div id="drop-zone" class="drop-zone">
        <div class="icon-large"><i class="fa-regular fa-image"></i></div>
        <h3 data-i18n="drag_drop">اضغط للرفع أو الصق الصورة (Ctrl+V)</h3>
        <p style="margin-top:10px; color:#94a3b8;">PNG / JPG</p>
        <input id="chartUpload" type="file" accept="image/*" style="display:none;" />
      </div>

      <!-- Controls -->
      <div class="controls-grid">
        <div class="control-group">
          <label data-i18n="analysis_label">الاستراتيجية</label>
          <div class="custom-select-wrapper">
            <select id="analysis-type">
              <option value="smc">SMC</option>
              <option value="ict">ICT</option>
              <option value="cana">CANA</option>
            </select>
            <i class="fa-solid fa-chevron-down"></i>
          </div>
        </div>

        <div class="control-group">
          <label data-i18n="timeframe_label">الإطار الزمني</label>
          <div class="custom-select-wrapper">
            <select id="timeframe-select">
              <option value="5m">5m</option>
              <option value="15m" selected>15m</option>
              <option value="1H">1H</option>
              <option value="4H">4H</option>
              <option value="Daily">Daily</option>
            </select>
            <i class="fa-solid fa-chevron-down"></i>
          </div>
        </div>
      </div>

      <button id="run-btn" class="btn-gradient full-width pulse-animation" data-i18n="run_btn">
        تحليل CANA الذكي
      </button>
    </div>

    <!-- ✅ Loading Overlay -->
    <div id="loading-box" class="loading-overlay hidden">
      <div class="cyber-spinner"></div>
      <p data-i18n="analyzing">نظام CANA يعالج البيانات...</p>
    </div>

    <!-- Result -->
    <div id="result-box" class="glass-card hidden">
      <div class="result-header">
        <h2 data-i18n="result_title">نتائج التوصية</h2>
        <div id="signal-badge-display" class="signal-badge">WAIT</div>
      </div>

      <div class="dashboard-grid">
        <div class="dash-card main-sig">
          <span class="lbl" data-i18n="signal">الإشارة</span>
          <span class="val" id="r-signal">---</span>
        </div>
        <div class="dash-card">
          <span class="lbl" data-i18n="entry">الدخول</span>
          <span class="val" id="r-entry">---</span>
        </div>
        <div class="dash-card">
          <span class="lbl" data-i18n="tp">الهدف (TP)</span>
          <span class="val" id="r-tp">---</span>
        </div>
        <div class="dash-card">
          <span class="lbl" data-i18n="sl">الوقف (SL)</span>
          <span class="val" id="r-sl">---</span>
        </div>
      </div>

      <div class="info-grid">
        <div class="info-item"><i class="fa-solid fa-clock"></i> <span id="r-timeframe">---</span></div>
        <div class="info-item"><i class="fa-solid fa-city"></i> <span id="r-session">---</span></div>
        <div class="info-item"><i class="fa-solid fa-hourglass-half"></i> <span id="r-validity">---</span></div>
      </div>

      <div class="notes-container">
        <h4 data-i18n="notes_label">منطق CANA</h4>
        <p id="r-notes">---</p>
        <p id="r-reason" style="margin-top:10px; color:#cbd5e1;">---</p>
      </div>

      <div class="chart-preview">
        <div data-i18n="chart_img">الشارت المعالج:</div>
        <img id="processed-img" src="" alt="processed chart"/>
      </div>

      <button id="close-result" class="btn-outline" data-i18n="close_btn">إغلاق التقرير</button>
    </div>
  </main>

  <!-- FOOTER -->
  <footer class="cana-footer">
    <div class="footer-content">

      <div class="footer-col">
        <div class="footer-logo"><i class="fa-solid fa-cubes"></i> CANA AI</div>
        <p class="footer-text">
          منصة تحليل تداول بالذكاء الاصطناعي. هدفنا: توصيات واضحة، واجهة أنيقة، وتجربة استخدام احترافية.
        </p>
        <div class="social-icons">
          <a href="#" aria-label="X"><i class="fa-brands fa-x-twitter"></i></a>
          <a href="#" aria-label="Telegram"><i class="fa-brands fa-telegram"></i></a>
          <a href="#" aria-label="YouTube"><i class="fa-brands fa-youtube"></i></a>
        </div>
      </div>

      <div class="footer-col">
        <h4 data-i18n="links_title">روابط</h4>
        <ul class="footer-links" style="list-style:none; padding:0; margin:0;">
          <li><a href="#" id="open-pricing-footer" data-i18n="link_pricing">الباقات والأسعار</a></li>
          <li><a href="#" id="open-privacy" data-i18n="link_privacy">سياسة الخصوصية</a></li>
          <li><a href="#" id="open-terms" data-i18n="link_terms">شروط الاستخدام</a></li>
        </ul>
      </div>

      <div class="footer-col">
        <h4 data-i18n="contact_title">التواصل</h4>
        <p class="footer-text" style="text-align:right;">
          <i class="fa-solid fa-location-dot" style="color:#3b82f6;"></i>
          <span data-i18n="addr_text">فلسطين - رام الله</span>
        </p>
        <a class="whatsapp-link" href="https://wa.me/970594060648" target="_blank" rel="noreferrer">
          <i class="fa-brands fa-whatsapp"></i> واتساب الدعم
        </a>
      </div>

    </div>

    <div class="footer-bottom">© 2025 CANA AI — All Rights Reserved</div>
  </footer>

  <!-- AUTH MODAL -->
  <div id="auth-overlay" class="modal-overlay hidden">
    <div class="modal-glass">
      <div class="close-icon" id="close-auth">✕</div>

      <h2 id="auth-title">Welcome to CANA</h2>

      <div class="auth-tabs">
        <button id="tab-login" class="auth-tab-btn active">Login</button>
        <button id="tab-register" class="auth-tab-btn">Register</button>
      </div>

      <form id="login-form">
        <div class="input-field">
          <i class="fa-solid fa-envelope"></i>
          <input id="login-email" type="email" placeholder="Email" />
        </div>
        <div class="input-field">
          <i class="fa-solid fa-lock"></i>
          <input id="login-password" type="password" placeholder="Password" />
        </div>
        <button class="btn-gradient full-width" type="submit">Login</button>
      </form>

      <form id="register-form" class="hidden">
        <div class="input-field">
          <i class="fa-solid fa-envelope"></i>
          <input id="reg-email" type="email" placeholder="Email" />
        </div>
        <div class="input-field">
          <i class="fa-solid fa-lock"></i>
          <input id="reg-password" type="password" placeholder="Password" />
        </div>
        <div class="input-field">
          <i class="fa-solid fa-lock"></i>
          <input id="reg-password2" type="password" placeholder="Confirm Password" />
        </div>
        <button class="btn-gradient full-width" type="submit">Create Account</button>
      </form>

      <div id="auth-msg" class="error-msg"></div>
    </div>
  </div>

  <!-- PORTFOLIO MODAL -->
  <div id="portfolio-modal" class="modal-overlay hidden">
    <div class="modal-glass extra-large">
      <div class="close-icon" id="close-portfolio">✕</div>

      <div class="portfolio-header-strip">
        <div class="user-identity">
          <div class="avatar-circle"><i class="fa-solid fa-user"></i></div>
          <div class="user-text">
            <h3 id="port-username">User</h3>
            <span id="port-plan-badge" class="plan-badge">Trader Plan</span>
          </div>
        </div>
        <div class="user-finance">
          <div class="finance-item">
            <span class="f-label">Credits</span>
            <span id="port-credits" class="f-value">0</span>
          </div>
        </div>
      </div>

      <div class="portfolio-grid">
        <div class="panel-box">
          <div class="panel-title"><i class="fa-solid fa-clock-rotate-left"></i> History</div>
          <table class="history-table">
            <thead>
              <tr>
                <th>Date</th><th>Signal</th><th>Entry</th><th>TP</th><th>Share</th>
              </tr>
            </thead>
            <tbody id="history-list">
              <tr><td colspan="5">Loading...</td></tr>
            </tbody>
          </table>
        </div>

        <div class="panel-box tool-mini">
          <div class="panel-title"><i class="fa-solid fa-calculator"></i> Tools</div>

          <div class="grid-2 mini-form">
            <input id="calc-balance" placeholder="Balance" />
            <input id="calc-risk" placeholder="Risk %" />
            <input id="calc-sl" class="full-span" placeholder="SL (pips)" />
            <button class="btn-gradient tiny full-span" onclick="calculateRisk()">Calc Lot</button>
          </div>

          <div id="risk-res" class="mini-res hidden">
            <div id="res-lot">---</div>
          </div>

          <hr style="border:0; border-top:1px solid #334155; margin:14px 0;">

          <div class="grid-2 mini-form">
            <input id="calc-lot-size" placeholder="Lot" />
            <input id="calc-pips-num" placeholder="Pips" />
            <button class="btn-gradient tiny full-span" onclick="calculatePipVal()">Calc $</button>
          </div>

          <div id="pip-res" class="mini-res hidden">
            <div id="res-profit">---</div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- SUBSCRIPTION / PRICING MODAL -->
  <div id="subscription-modal" class="modal-overlay hidden">
    <div class="modal-glass large">
      <div class="close-icon" id="close-sub">✕</div>

      <h2 style="margin-bottom:10px;">الباقات والاشتراك</h2>
      <p style="color:#94a3b8; margin-bottom:20px;">اختر الباقة ثم اتبع معلومات التحويل.</p>

      <div class="pricing-container">
        <div class="plan-card featured">
          <div class="badge">Popular</div>
          <h3>Starter</h3>
          <div class="price">$5</div>
          <p style="color:#94a3b8; font-size:0.9rem;">15 Analyses</p>
          <button class="btn-outline">Select</button>
        </div>

        <div class="plan-card">
          <h3>Pro</h3>
          <div class="price">$15</div>
          <p style="color:#94a3b8; font-size:0.9rem;">60 Analyses</p>
          <button class="btn-outline">Select</button>
        </div>

        <div class="plan-card">
          <h3>Ultra</h3>
          <div class="price">$30</div>
          <p style="color:#94a3b8; font-size:0.9rem;">150 Analyses</p>
          <button class="btn-outline">Select</button>
        </div>

        <div class="plan-card vip-card">
          <div class="vip-badge">VIP</div>
          <h3>WHALE</h3>
          <div class="price">$99</div>
          <p style="color:#94a3b8; font-size:0.9rem;">Unlimited*</p>
          <button class="btn-outline">Select</button>
        </div>
      </div>

      <div class="payment-section-styled">
        <div class="pay-title">Payment Details</div>

        <div class="bank-details-box">
          <div class="bank-header">
            <div class="bank-logo-text">
              <i class="fa-solid fa-building-columns"></i> Bank Transfer
            </div>
            <div class="branch-name">Palestine</div>
          </div>

          <div class="details-grid">
            <div class="detail-item">
              <span class="label">Bank</span>
              <span class="value">Bank of Palestine</span>
            </div>
            <div class="detail-item">
              <span class="label">SWIFT / BIC</span>
              <span class="value">PALSPS22</span>
            </div>
            <div class="detail-item">
              <span class="label">Branch</span>
              <span class="value">Main Branch</span>
            </div>
            <div class="detail-item">
              <span class="label">Buraq</span>
              <span class="value highlight-buraq">Available (Instant)</span>
            </div>
          </div>

          <div class="iban-wrapper">
            <span class="iban-label">IBAN</span>
            <div class="iban-code-box">
              <code id="iban-code">PS00BOP0000000000000000000000</code>
              <button class="copy-btn" onclick="navigator.clipboard.writeText(document.getElementById('iban-code').innerText)">
                <i class="fa-regular fa-copy"></i> Copy
              </button>
            </div>
          </div>

          <a class="whatsapp-link" href="https://wa.me/970594060648" target="_blank" rel="noreferrer">
            <i class="fa-brands fa-whatsapp"></i> WhatsApp Support
          </a>
        </div>
      </div>

    </div>
  </div>

  <!-- TERMS MODAL -->
  <div id="terms-modal" class="modal-overlay hidden">
    <div class="modal-glass">
      <div class="close-icon" id="close-terms">✕</div>
      <h2 data-i18n="terms_title">شروط الاستخدام</h2>
      <div style="color:#cbd5e1; line-height:1.8; margin-top:15px;" data-i18n="terms_body">
        <p>CANA AI أداة تعليمية وليست نصيحة مالية.</p>
      </div>
    </div>
  </div>

  <!-- PRIVACY MODAL -->
  <div id="privacy-modal" class="modal-overlay hidden">
    <div class="modal-glass">
      <div class="close-icon" id="close-privacy">✕</div>
      <h2 data-i18n="privacy_title">سياسة الخصوصية</h2>
      <div style="color:#cbd5e1; line-height:1.8; margin-top:15px;" data-i18n="privacy_body">
        <p>نحمي بياناتك ولا نشاركها.</p>
      </div>
    </div>
  </div>

  <!-- Share Card Template -->
  <div id="share-card-template" class="share-card-hidden">
    <div class="sc-header">
      <div class="sc-logo">CANA AI</div>
      <div style="color:#94a3b8;font-size:0.8rem;">AI TRADING</div>
    </div>
    <div class="sc-body">
      <div class="sc-row main" id="sc-signal">WAIT</div>
      <div class="sc-row"><span>Entry</span><span id="sc-entry">---</span></div>
      <div class="sc-row"><span>TP</span><span id="sc-tp">---</span></div>
      <div class="sc-row"><span>SL</span><span id="sc-sl">---</span></div>
    </div>
    <div class="sc-footer">CANA • MRTRADE</div>
  </div>

  <!-- html2canvas for share -->
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>

  <!-- ✅ كسر كاش -->
  <script src="/static/script.js?v=fix_final_9"></script>
</body>
</html>
